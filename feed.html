<!DOCTYPE html>
<html lang="pt-br" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Feed | Admin FSJPII</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="feed.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel ="icon" href = "logo_fsjpii.ico">
</head>

<body>
  <!-- HEADER -->
  <header class="topbar">
    <!-- Logo √† esquerda -->
    <div class="logo-container">
      <img src="logo_fsjpii.png" alt="FSJPII Logo" class="header-logo">
    </div>

    <!-- T√≠tulo centralizado -->
    <h2>FSJPII ‚Ä¢ Admin</h2>

    <!-- Bot√£o hamb√∫rguer para mobile -->
    <button id="mobileMenuToggle" class="mobile-menu-toggle" aria-label="Abrir menu">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Bot√µes √† direita -->
    <div class="header-actions">
      <!-- Bot√£o Tema -->
      <button id="btnTheme" class="btn-theme" type="button" aria-label="Alternar tema">
        <i class="fas fa-sun"></i>
      </button>
      
      <!-- Bot√£o Sair -->
      <button id="btnLogout" class="btn-logout" type="button">Sair</button>
    </div>
  </header>

  <!-- Menu Mobile -->
  <div id="mobileMenu" class="mobile-menu">
    <div class="mobile-menu-header">
      <button id="mobileMenuClose" class="mobile-menu-close" aria-label="Fechar menu">
        <i class="fas fa-times"></i>
      </button>
      <h3>Menu</h3>
    </div>
    
    <div class="mobile-menu-content">
      <!-- Minha Conta -->
      <div class="mobile-menu-section">
        <div class="mobile-menu-title">Minha conta</div>
        <div class="mobile-profile">
          <div class="mobile-avatar"></div>
          <div class="mobile-profile-text">
            <div id="mobileProfileName" class="mobile-profile-name">Usu√°rio</div>
            <div id="mobileProfileRole" class="mobile-profile-role">carregando‚Ä¶</div>
          </div>
        </div>
      </div>

      <!-- Menu Principal -->
      <div class="mobile-menu-section">
        <div class="mobile-menu-title">Menu</div>
        <button class="mobile-menu-link active" type="button" data-view="feed">
          <i class="fas fa-home"></i> Feed
        </button>
        <button class="mobile-menu-link" type="button" data-view="notifications">
          <i class="fas fa-bell"></i> Notifica√ß√µes 
          <span id="mobileNotifBadge" class="mobile-badge" style="display:none;">0</span>
        </button>
        <button class="mobile-menu-link" type="button" data-view="notices">
          <i class="fas fa-exclamation-circle"></i> Avisos
        </button>
        <button class="mobile-menu-link" type="button" data-view="events">
          <i class="fas fa-calendar"></i> Eventos
        </button>
      </div>

      <!-- Atalhos Admin (somente para admin) -->
      <div class="mobile-menu-section admin-only" id="mobileAdminShortcuts" style="display:none;">
        <div class="mobile-menu-title">Criar aviso</div>
        <button class="mobile-menu-link" type="button" id="mobileBtnNewPinned">
          <i class="fas fa-thumbtack"></i> Novo aviso fixado
        </button>
      </div>
    </div>
  </div>
  <div id="mobileMenuOverlay" class="mobile-menu-overlay"></div>

  <div class="app-scroll">
    <div class="layout">
      <!-- Sidebar esquerda (Desktop) -->
      <aside class="sidebar sidebar-left" id="leftSidebar">
        <div class="side-card">
          <div class="side-title">Minha conta</div>
          <div class="profile-mini">
            <div class="avatar-mini" aria-hidden="true"></div>
            <div class="profile-mini-text">
              <div id="miniProfileName" class="profile-name">Usu√°rio</div>
              <div id="miniProfileRole" class="profile-role">carregando‚Ä¶</div>
            </div>
          </div>
        </div>

        <div class="side-card">
          <div class="side-title">Menu</div>
          <button class="side-link active" type="button" id="navFeed" data-view="feed">Feed</button>
          <button class="side-link" type="button" id="navNotifications" data-view="notifications">
            Notifica√ß√µes <span id="notifBadge" class="side-badge" style="display:none;">0</span>
          </button>
          <button class="side-link" type="button" id="navNotices" data-view="notices">Avisos</button>
          <button class="side-link" type="button" id="navEvents" data-view="events">Eventos</button>
        </div>

        <div class="side-card admin-only" id="adminShortcuts" style="display:none;">
          <div class="side-title">Criar aviso</div>
          <button class="side-link" type="button" id="btnNewPinned">üìå Novo aviso fixado</button>
          <div class="side-hint">Dica: voc√™ tamb√©m pode fixar qualquer post pelo √≠cone üìå no card.</div>
        </div>
      </aside>

      <!-- Feed central -->
      <main id="mainContent" class="main-content">
        <section class="view view-active" id="view-feed" data-view="feed">
          <div id="feed"></div>
        </section>

        <section class="view" id="view-notifications" data-view="notifications">
          <div class="view-header">
            <h3>Notifica√ß√µes</h3>
            <button id="btnMarkRead" type="button" class="view-action">Marcar como lidas</button>
          </div>
          <div id="notifList" class="view-list"></div>
          <div id="notifEmpty" class="side-empty" style="display:none;">Sem notifica√ß√µes.</div>
        </section>

        <section class="view" id="view-notices" data-view="notices">
          <div class="view-header">
            <div class="view-header-left">
              <h3 id="noticesHeaderTitle">Avisos</h3>
              <div id="noticesModeToggle" class="segmented" role="tablist" aria-label="Avisos e aniversariantes">
                <button type="button" class="seg-btn active" data-mode="notices" role="tab" aria-selected="true">Avisos</button>
                <button type="button" class="seg-btn" data-mode="birthdays" role="tab" aria-selected="false">Aniversariantes</button>
              </div>
            </div>
            <button id="btnNewPinnedCenter" type="button" class="view-action">üìå Novo aviso fixado</button>
          </div>
          <div id="noticesList" class="view-list"></div>
          <div id="noticesEmpty" class="side-empty" style="display:none;">Nenhum aviso fixado ainda.</div>
        </section>

        <section class="view" id="view-events" data-view="events">
          <div class="view-header">
            <h3>Eventos</h3>
            <button id="btnNewEvent" type="button" class="view-action">Ôºã Novo evento</button>
          </div>
          <div id="eventsList" class="view-list"></div>
          <div id="eventsEmpty" class="side-empty">Em breve: calend√°rio de eventos.</div>
        </section>
      </main>

      <!-- Sidebar direita -->
      <aside class="sidebar sidebar-right" id="rightSidebar">
        <div class="side-card">
          <div class="side-title">Avisos fixados</div>
          <div id="pinnedList" class="side-list"></div>
          <div id="pinnedEmpty" class="side-empty" style="display:none;">Nenhum aviso fixado ainda.</div>
        </div>

        <div class="side-card">
          <div class="side-title">Atividade recente</div>
          <div id="activityList" class="side-list"></div>
          <div id="activityEmpty" class="side-empty" style="display:none;">Sem atividade recente.</div>
        </div>
      </aside>
    </div>
  </div>
    
  <!-- BOT√ÉO + -->
  <button class="add-post" onclick="abrirGaleria()" aria-label="Novo post">+</button>

  <!-- INPUT INVIS√çVEL -->
  <input type="file" id="fileInput" accept="image/*" hidden />

  <!-- MODAL DE NOVO POST -->
  <div class="modal" id="postModal" aria-hidden="true">
    <div class="modal-card">

      <button class="modal-close" id="closeModal" aria-label="Fechar">√ó</button>

      <h3>Novo post</h3>

      <div class="modal-preview">
        <img id="previewImg" alt="Pr√©via da imagem" />
      </div>

      <label for="captionInput">Legenda</label>
      <textarea id="captionInput" rows="3" placeholder="Escreva a legenda..."></textarea>

      <div class="modal-actions">
        <button class="btn secondary" id="cancelPost" type="button">Cancelar</button>
        <button class="btn primary" id="publishPost" type="button">Publicar</button>
      </div>

    </div>
  </div>

  <!-- MODAL DE QUEM CURTIU -->
  <div class="modal" id="likesModal" aria-hidden="true">
    <div class="modal-card">
      <button class="modal-close" id="closeLikesModal" aria-label="Fechar">√ó</button>
      <h3>Quem curtiu</h3>
      <div id="likesList" class="likes-list">
        <!-- Lista de usu√°rios que curtiram ser√° carregada aqui -->
      </div>
    </div>
  </div>

  <!-- FUNDO DIN√ÇMICO -->
  <div id="logoBg"></div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabaseClient.js"></script>

  <!-- Seu JS do feed -->
  <script src="feed.js"></script>

  <!-- JS do fundo animado e tema -->
  <script>
    // FUNDO ANIMADO COM BOLINHAS EM AMBOS OS TEMAS
    document.addEventListener('DOMContentLoaded', function() {
      const container = document.getElementById('logoBg');
      let particles = [];
      let animationId = null;
      
      // Criar part√≠culas MUITO LENTAS
      function createParticles() {
        const width = window.innerWidth;
        const height = window.innerHeight;
        const particleCount = Math.floor((width * height) / 7000); // Menos part√≠culas
        
        // Limpar part√≠culas anteriores
        particles = [];
        container.innerHTML = '';
        
        // Distribui√ß√£o de cores baseada no tema
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const isDark = currentTheme === 'dark';
        
        // Para tema escuro: cores vibrantes
        // Para tema claro: cores suaves
        const wineCount = Math.floor(particleCount * 0.45);
        const blueCount = Math.floor(particleCount * 0.45);
        const goldCount = particleCount - wineCount - blueCount;
        
        // Criar part√≠culas
        createParticleBatch(wineCount, 'particle-wine', isDark);
        createParticleBatch(blueCount, 'particle-blue', isDark);
        createParticleBatch(goldCount, 'particle-gold', isDark);
      }
      
      function createParticleBatch(count, colorClass, isDark) {
        for (let i = 0; i < count; i++) {
          const particle = document.createElement('div');
          particle.className = `logo-particle ${colorClass}`;
          
          // Tamanho menor no tema claro
          const size = isDark ? (Math.random() * 4 + 3) : (Math.random() * 3 + 2);
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          
          // Posi√ß√£o inicial
          const x = Math.random() * 100;
          const y = Math.random() * 100;
          
          // Velocidade MUITO LENTA (90% mais lento que o original)
          particles.push({
            element: particle,
            x: x,
            y: y,
            speedX: (Math.random() - 0.5) * 0.08, // EXTREMAMENTE LENTO
            speedY: (Math.random() - 0.5) * 0.08, // EXTREMAMENTE LENTO
            floatSpeed: Math.random() * 0.005 + 0.002, // MUITO LENTO
            floatPhase: Math.random() * Math.PI * 2,
            floatAmplitude: Math.random() * 8 + 5, // Amplitude pequena
            pulseSpeed: Math.random() * 0.002 + 0.0005, // Pulsa√ß√£o MUITO LENTA
            pulsePhase: Math.random() * Math.PI * 2,
            colorClass: colorClass,
            size: size,
            isDark: isDark
          });
          
          // Posicionar inicialmente
          updateParticlePosition(particles[particles.length - 1]);
          container.appendChild(particle);
        }
      }
      
      function updateParticlePosition(p) {
        const now = Date.now() * 0.001;
        
        // Movimento flutuante MUITO LENTO
        p.x += p.speedX * 0.04; // EXTREMAMENTE LENTO
        p.y += p.speedY * 0.04; // EXTREMAMENTE LENTO
        
        // Adicionar flutua√ß√£o MUITO LENTA
        p.x += Math.cos(now * p.floatSpeed + p.floatPhase) * 0.1;
        p.y += Math.sin(now * p.floatSpeed * 1.1 + p.floatPhase) * 0.1;
        
        // Garantir que n√£o saia da tela
        if (p.x < 0) p.x = 100;
        if (p.x > 100) p.x = 0;
        if (p.y < 0) p.y = 100;
        if (p.y > 100) p.y = 0;
        
        // Pulsa√ß√£o MUITO LENTA
        const pulse = Math.sin(now * p.pulseSpeed + p.pulsePhase) * 0.15 + 0.7;
        p.element.style.opacity = pulse;
        
        // Efeito de escala muito suave
        const scale = 1 + Math.sin(now * p.pulseSpeed * 0.4 + p.pulsePhase) * 0.08;
        p.element.style.transform = `translate(${p.x}vw, ${p.y}vh) scale(${scale})`;
        
        // Ajustar opacidade baseada no tema
        p.element.style.opacity = p.isDark ? pulse * 0.85 : pulse * 0.6;
      }
      
      // Anima√ß√£o
      function animateParticles() {
        // Atualizar todas as part√≠culas
        for (let i = 0; i < particles.length; i++) {
          updateParticlePosition(particles[i]);
        }
        
        animationId = requestAnimationFrame(animateParticles);
      }
      
      // Inicializar part√≠culas
      function initParticles() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        container.style.display = 'block';
        
        // Atualizar propriedades baseadas no tema
        particles.forEach(p => {
          p.isDark = currentTheme === 'dark';
        });
        
        createParticles();
        if (!animationId) {
          animationId = requestAnimationFrame(animateParticles);
        }
      }
      
      // Inicializar
      initParticles();
      
      // Redimensionar com debounce
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          initParticles();
        }, 300);
      });
      
      // Observar mudan√ßas de tema
      const themeObserver = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === 'data-theme') {
            setTimeout(() => {
              initParticles();
            }, 150);
          }
        });
      });
      
      themeObserver.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme']
      });
    });
    
    // SISTEMA DE TEMA CLARO/ESCURO
    document.addEventListener('DOMContentLoaded', function() {
      const themeButton = document.getElementById('btnTheme');
      const themeIcon = themeButton.querySelector('i');
      
      // Carregar tema salvo ou usar escuro como padr√£o
      const savedTheme = localStorage.getItem('fsjpii-theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      
      // Atualizar √≠cone baseado no tema
      function updateThemeIcon() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        if (currentTheme === 'light') {
          themeIcon.className = 'fas fa-moon';
          themeButton.setAttribute('aria-label', 'Alternar para tema escuro');
        } else {
          themeIcon.className = 'fas fa-sun';
          themeButton.setAttribute('aria-label', 'Alternar para tema claro');
        }
      }
      
      // Inicializar √≠cone
      updateThemeIcon();
      
      // Alternar tema ao clicar
      themeButton.addEventListener('click', function() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        // Aplicar novo tema
        document.documentElement.setAttribute('data-theme', newTheme);
        
        // Salvar prefer√™ncia
        localStorage.setItem('fsjpii-theme', newTheme);
        
        // Atualizar √≠cone
        updateThemeIcon();
      });
    });
  </script>

</body>
</html>
